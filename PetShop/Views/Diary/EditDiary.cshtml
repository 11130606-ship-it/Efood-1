@model PetShop.Models.DiaryEntry
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="mb-4">📔 飲食紀錄</h2>
<div class="page-wrapper">
    <div class="container mt-5">
        <form method="post" action="/Home/EditDiary">
            <input type="hidden" name="Id" value="@Model.Id" />
            <div class="form-group">
                <label>餐別</label>
                <select name="MealType" class="form-control" required>
                    <option value="">-- 請選擇餐別 --</option>
                    <option value="早餐" @(Model.MealType == "早餐" ? "selected" : "")>早餐</option>
                    <option value="午餐" @(Model.MealType == "午餐" ? "selected" : "")>午餐</option>
                    <option value="晚餐" @(Model.MealType == "晚餐" ? "selected" : "")>晚餐</option>
                    <option value="點心" @(Model.MealType == "點心" ? "selected" : "")>點心</option>
                </select>
            </div>
            <div class="form-group">
                <label>食物</label>
                <input type="text" name="Food" class="form-control" value="@Model.Food" />
            </div>
            <div class="form-group">
                <label>份數</label>
                <input type="number" name="Quantity" class="form-control" value="@Model.Quantity" />
            </div>
            <div class="form-group">
                <label>熱量</label>
                <input type="number" name="Calories" class="form-control" value="@Model.Calories" />
            </div>
            <div class="form-group">
                <label>蛋白質</label>
                <input type="number" name="Protein" class="form-control" value="@Model.Protein" />
            </div>
            <div class="form-group">
                <label>脂肪</label>
                <input type="number" name="Fat" class="form-control" value="@Model.Fat" />
            </div>
            <div class="form-group">
                <label>碳水化合物</label>
                <input type="number" name="Carbs" class="form-control" value="@Model.Carbs" />
            </div>
            <button type="submit" class="btn btn-primary">儲存</button>
            @*<a href="@Url.Action("DiaryIndex", "Home")" class="btn btn-secondary">取消</a>*@
            <button type="button" class="btn btn-secondary" onclick="location.href='@Url.Action("DiaryIndex", "Home")'">取消</button>
        </form>
    </div>
</div>

<script>
    // 取得原本數量
    let originalQty = parseInt(document.querySelector('input[name="Quantity"]').value) || 1;
    // 取得原本總營養成分
    let baseCalories = parseFloat(document.querySelector('input[name="Calories"]').value) || 0;
    let baseProtein = parseFloat(document.querySelector('input[name="Protein"]').value) || 0;
    let baseFat = parseFloat(document.querySelector('input[name="Fat"]').value) || 0;
    let baseCarbs = parseFloat(document.querySelector('input[name="Carbs"]').value) || 0;

    // 計算每份營養成分
    let perCalories = baseCalories / originalQty;
    let perProtein = baseProtein / originalQty;
    let perFat = baseFat / originalQty;
    let perCarbs = baseCarbs / originalQty;

    // 綁定數量欄位事件
    document.querySelector('input[name="Quantity"]').addEventListener('input', function () {
        let qty = parseInt(this.value) || 1;
        document.querySelector('input[name="Calories"]').value = Math.round(perCalories * qty);
        document.querySelector('input[name="Protein"]').value = Math.round(perProtein * qty);
        document.querySelector('input[name="Fat"]').value = Math.round(perFat * qty);
        document.querySelector('input[name="Carbs"]').value = Math.round(perCarbs * qty);
    });
</script>